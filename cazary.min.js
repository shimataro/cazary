/*! Cazary (jQuery 1.7+) - JavaScript WYSIWYG editor (https://github.com/shimataro/cazary) */
(function(p){"object"===typeof module&&"object"===typeof module.exports?module.exports=p(require("jquery"),window):p(jQuery,window)})(function(p,t,f){var G=t.document,l=function(){var a={ja:{"Insert Image":"\u753b\u50cf\u633f\u5165","Size 5":"\u30b5\u30a4\u30ba5","Show Source":"HTML\u30bd\u30fc\u30b9\u8868\u793a","Size 4":"\u30b5\u30a4\u30ba4","Justify Right":"\u53f3\u63c3\u3048","Remove Format":"\u66f8\u5f0f\u3092\u30af\u30ea\u30a2","Justify Center":"\u4e2d\u592e\u63c3\u3048",Italic:"\u659c\u4f53",
"Size 1":"\u30b5\u30a4\u30ba1",Subscript:"\u4e0b\u4ed8\u304d\u6587\u5b57",Preview:"\u30d7\u30ec\u30d3\u30e5\u30fc","Input link URL or E-mail address":"\u30ea\u30f3\u30af\u5148URL\u307e\u305f\u306f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",Bold:"\u592a\u5b57","Unordered List":"\u7b87\u6761\u66f8\u304d","Input image URL":"\u753b\u50cfURL\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",Undo:"\u5143\u306b\u623b\u3059","Strike-Through":"\u6253\u3061\u6d88\u3057\u7dda",
"Horizontal Rule":"\u6a2a\u7dda",Superscript:"\u4e0a\u4ed8\u304d\u6587\u5b57",Outdent:"\u5b57\u4e0b\u3052\u89e3\u9664","Background Color":"\u80cc\u666f\u8272","Size 7":"\u30b5\u30a4\u30ba7","Size 6":"\u30b5\u30a4\u30ba6",Indent:"\u5b57\u4e0b\u3052","Size 3":"\u30b5\u30a4\u30ba3","Size 2":"\u30b5\u30a4\u30ba2",Insert:"\u633f\u5165","Ordered List":"\u756a\u53f7\u4ed8\u304d\u30ea\u30b9\u30c8","Justify Left":"\u5de6\u63c3\u3048","Justify Full":"\u4e21\u7aef\u63c3\u3048","Foreground Color":"\u6587\u5b57\u8272",
Unlink:"\u30ea\u30f3\u30af\u89e3\u9664","Insert Link":"\u30ea\u30f3\u30af\u633f\u5165",Font:"\u30d5\u30a9\u30f3\u30c8",Redo:"\u3084\u308a\u76f4\u3057",Underline:"\u4e0b\u7dda",Size:"\u30b5\u30a4\u30ba"},pl:{"Insert Image":"Wstaw obrazek","Size 5":"Rozmiar 5","Show Source":"Poka\u017c \u017ar\u00f3d\u0142o","Size 4":"Rozmiar 4","Justify Right":"Wyr\u00f3wnaj do prawej","Remove Format":"Usu\u0144 formatowanie","Justify Center":"Wyr\u00f3wnaj do \u015brodka",Italic:"Kursywa","Size 1":"Rozmiar 1",Subscript:"Indeks dolny",
Preview:"Podgl\u0105d","Input link URL or E-mail address":"Wprowad\u017a adres URL lub E-mail",Bold:"Pogrubienie","Unordered List":"Punktory","Input image URL":"Adres obrazka",Undo:"Cofnij","Strike-Through":"Przekre\u015blenie","Horizontal Rule":"Pozioma linia",Superscript:"Indeks g\u00f3rny",Outdent:"Zmniejsz wci\u0119cie","Background Color":"Kolor t\u0142a","Size 7":"Rozmiar 7","Size 6":"Rozmiar 6",Indent:"Zwi\u0119ksz wci\u0119cie","Size 3":"Rozmiar 3","Size 2":"Rozmiar 2",Insert:"Wstaw","Ordered List":"Numerowanie",
"Justify Left":"Wyr\u00f3wnanie do lewej","Justify Full":"Wyjustowanie","Foreground Color":"Kolor czcionki",Unlink:"Usu\u0144 link","Insert Link":"Wstaw link",Font:"Czcionka",Redo:"Powt\u00f3rz",Underline:"Podkre\u015blenie",Size:"Rozmiar"}},E=function(){var d;try{var g=t.navigator;d=g.browserLanguage||g.language||g.userLanguage}catch(E){d=f}g=a[d];if(g!==f)return g;d=d.split("-")[0];g=a[d];return g!==f?g:{}}();return function(a){return E[a]===f?a:E[a]}}(),L=function(){var a=/^[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~](\.?[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~])*@([\w\-]+\.)+(\w+)$/;
return function(f){return 256<f.length||64<f.indexOf("@")||null==f.match(a)?!1:!0}}(),B=function(){var a=/^https?:\/\//;return function(f){return null==f.match(a)?!1:!0}}(),Q=function(){return function(a,l,d){function g(a,e){"backcolor"==a&&v("hilitecolor")&&(a="hilitecolor");b();h.execCommand(a,!1,e)}function v(a){try{return h.queryCommandEnabled(a)}catch(e){return!1}}function t(){if(q.getSelection){var a=q.getSelection();return null===a||0===a.rangeCount?"":a.getRangeAt(0).toString()}return h.selection.createRange().text}
function b(){q.focus();null!==w&&w.select()}var q=a.contentWindow,h=q.document;a.contentDocument&&(h=a.contentDocument);var w=null;this.STATUS_NORMAL=0;this.STATUS_ACTIVE=1;this.STATUS_DISABLED=2;this.COMMAND_FONTNAME="fontname";this.COMMAND_FONTSIZE="fontsize";this.COMMAND_BOLD="bold";this.COMMAND_ITALIC="italic";this.COMMAND_UNDERLINE="underline";this.COMMAND_STRIKETHROUGH="strikethrough";this.COMMAND_REMOVEFORMAT="removeformat";this.COMMAND_FORECOLOR="forecolor";this.COMMAND_BACKCOLOR="backcolor";
this.COMMAND_SUPERSCRIPT="superscript";this.COMMAND_SUBSCRIPT="subscript";this.COMMAND_JUSTIFYLEFT="justifyleft";this.COMMAND_JUSTIFYCENTER="justifycenter";this.COMMAND_JUSTIFYRIGHT="justifyright";this.COMMAND_JUSTIFYFULL="justifyfull";this.COMMAND_INDENT="indent";this.COMMAND_OUTDENT="outdent";this.COMMAND_ORDEREDLIST="insertorderedlist";this.COMMAND_UNORDEREDLIST="insertunorderedlist";this.COMMAND_INSERTHORIZONTALRULE="inserthorizontalrule";this.COMMAND_INSERTIMAGE="insertimage";this.COMMAND_CREATELINK=
"createlink";this.COMMAND_UNLINK="unlink";this.COMMAND_UNDO="undo";this.COMMAND_REDO="redo";this.contentWindow=q;this.contentDocument=h;this.getCurrentStatus=function(){var a={fontname:null,fontsize:null,forecolor:null,backcolor:null,bold:0,italic:0,underline:0,strikethrough:0,superscript:0,subscript:0,justifyleft:0,justifycenter:0,justifyright:0,justifyfull:0,insertorderedlist:0,insertunorderedlist:0,createlink:0,unlink:0,undo:0,redo:0};""==t()&&(a.createlink=2,a.unlink=2);p.each(["createlink","unlink",
"undo","redo"],function(b,e){v(e)||(a[e]=2)});for(var e=q.getSelection?q.getSelection().anchorNode:h.selection.createRange().parentElement();null!==e;){if(e.tagName!==f)switch(e.tagName.toLowerCase()){case "b":case "strong":a.bold=1;break;case "i":case "em":a.italic=1;break;case "u":a.underline=1;break;case "s":case "strike":case "del":a.strikethrough=1;break;case "sup":a.superscript=1;break;case "sub":a.subscript=1;break;case "ol":a.insertorderedlist=1;break;case "ul":a.insertunorderedlist=1;break;
case "font":0<e.face.length&&null===a.fontname&&(a.fontname=e.face),0<e.size.length&&null===a.fontsize&&(a.fontsize=e.size),0<e.color.length&&null===a.forecolor&&(a.forecolor=e.color)}if(e.align!==f)switch(e.align.toLowerCase()){case "left":a.justifyleft=1;break;case "center":a.justifycenter=1;break;case "right":a.justifyright=1;break;case "justify":a.justifyfull=1}if(e.style!==f){var b=e.style;if(b.fontFamily!==f){var d=b.fontFamily;0<d.length&&null===a.fontname&&(a.fontname=d)}if(b.fontWeight!==
f)switch(b.fontWeight.toLowerCase()){case "bold":case "bolder":a.bold=1}if(b.fontStyle!==f)switch(b.fontStyle.toLowerCase()){case "italic":case "oblique":a.italic=1}b.textDecoration!==f&&(d=b.textDecoration.toLowerCase(),-1!==d.indexOf("underline")&&(a.underline=1),-1!==d.indexOf("line-through")&&(a.strikethrough=1));b.color!==f&&(d=b.color,0<d.length&&null===a.forecolor&&(a.forecolor=d));b.backgroundColor!==f&&(d=b.backgroundColor,0<d.length&&null===a.backcolor&&(a.backcolor=d));if(b.verticalAlign!==
f)switch(b.verticalAlign.toLowerCase()){case "super":a.superscript=1;break;case "sub":a.subscript=1}if(b.textAlign!==f)switch(b.textAlign.toLowerCase()){case "left":a.justifyleft=1;break;case "center":a.justifycenter=1;break;case "right":a.justifyright=1;break;case "justify":a.justifyfull=1}}e=e.parentNode}h.selection&&(w=h.selection.createRange());return a};this.execCommand=g;this.canExecCommand=v;this.value=function(a){if(a===f)return a=h.body.innerHTML,a=a.replace(/(<\/?)p\b/gi,"$1div").replace(/(<\/?)em\b/gi,
"$1i").replace(/(<\/?)strong\b/gi,"$1b").replace(/(<\/?)del\b/gi,"$1s");h.body.innerHTML=a};this.getSelectedText=t;this.insertText=function(a,e){if(q.getSelection){var d=h.createTextNode(a),f=q.getSelection();f.deleteFromDocument();f.getRangeAt(0).insertNode(d)}else h.selection.createRange().text=a;e?g("removeformat"):b()};this.setFocus=b;(function(a){var b='<!DOCTYPE html><html><head><meta charset="UTF-8" /><style type="text/css">'+d+"</style></head><body></body></html>";h.designMode="on";h.open();
h.write(b);h.close();h.body.innerHTML=a})(l)}}();p.fn.extend({cazary:function(a){function p(b){"string"===typeof b&&(b=C[b]!==f?C[b]:[b]);var d=a("<div />").addClass("cazary-commands-wrapper");a.each(b,function(){var b=a("<ul />").addClass("cazary-commands-list"),p=this.toLowerCase().split(" ");a.each(p,function(){var d=this.toString();"|"===d&&(d="separator");if(g[d]!==f){var e=l(g[d]),d="cazary-command-"+d,e=a("<li />").attr({unselectable:"on",title:e}).addClass(d).text(e);b.append(e)}});d.append(b)});
return d}function d(){a(".cazary-panel").each(function(){var b=".cazary-command-"+a(this).data("command");a(b).removeClass("cazary-active")}).remove()}var g={separator:"",fontname:"Font",fontsize:"Size",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strike-Through",removeformat:"Remove Format",forecolor:"Foreground Color",backcolor:"Background Color",superscript:"Superscript",subscript:"Subscript",justifyleft:"Justify Left",justifycenter:"Justify Center",justifyright:"Justify Right",
justifyfull:"Justify Full",indent:"Indent",outdent:"Outdent",insertorderedlist:"Ordered List",insertunorderedlist:"Unordered List",inserthorizontalrule:"Horizontal Rule",insertimage:"Insert Image",createlink:"Insert Link",unlink:"Unlink",undo:"Undo",redo:"Redo",source:"Show Source"},v={1:"Size 1",2:"Size 2",3:"Size 3",4:"Size 4",5:"Size 5",6:"Size 6",7:"Size 7"},C={MINIMAL:["bold italic underline strikethrough removeformat"],STANDARD:["fontname fontsize","bold italic underline strikethrough removeformat | forecolor backcolor | superscript subscript",
"source"],FULL:"fontname fontsize;bold italic underline strikethrough removeformat | forecolor backcolor | superscript subscript;justifyleft justifycenter justifyright justifyfull | indent outdent | insertorderedlist insertunorderedlist;inserthorizontalrule insertimage createlink unlink;undo redo;source".split(";")};a(function(a){a(G).on("click",function(){d()}).on("keydown",function(a){27===a.keyCode&&d()})});return function(b){b=a.extend({mode:"rte",style:"body{margin:0px;padding:8px;}p{margin:0px;padding:0px;}",
fontnames:"sans-serif;serif;cursive;fantasy;monospace;Arial;Arial Black;Comic Sans MS;Courier New;Narrow;Garamond;Georgia;Impact;Tahoma;Times New Roman;Trebuchet MS;Verdana".split(";"),colors:["#ffffff #ffcccc #ffcc99 #ffff99 #ffffcc #99ff99 #99ffff #ccffff #ccccff #ffccff".split(" "),"#cccccc #ff6666 #ff9966 #ffff66 #ffff33 #66ff99 #33ffff #66ffff #9999ff #ff99ff".split(" "),"#bbbbbb #ff0000 #ff9900 #ffcc66 #ffff00 #33ff33 #66cccc #33ccff #6666cc #cc66cc".split(" "),"#999999 #cc0000 #ff6600 #ffcc33 #ffcc00 #33cc00 #00cccc #3366ff #6633ff #cc33cc".split(" "),
"#666666 #990000 #cc6600 #cc9933 #999900 #009900 #339999 #3333ff #6600cc #993399".split(" "),"#333333 #660000 #993300 #996633 #666600 #006600 #336666 #000099 #333399 #663366".split(" "),"#000000 #330000 #663300 #663333 #333300 #003300 #003333 #000066 #330099 #330033".split(" ")],commands:"STANDARD"},b);return this.each(function(){function g(a,b){d();c.execCommand(a,b);x()}function h(){var a=n.val();c.value(a);H();n.hide();D.css("display","");I.removeClass("cazary-disabled");z.removeClass("cazary-active");
x()}function w(){var a=c.value();n.val(a);D.hide();n.css("display","");I.addClass("cazary-disabled");z.addClass("cazary-active")}function C(b,u,J){var k=a(".cazary-panel");if(0<k.length){var r=k.data("id"),k=k.data("command");d();if(k===b&&r===K){F();return}}r=!1;switch(b){case c.COMMAND_FONTNAME:k=e(b,u.fontnames);r=!0;break;case c.COMMAND_FONTSIZE:k=O(b);r=!0;break;case c.COMMAND_FORECOLOR:case c.COMMAND_BACKCOLOR:k=P(b,u.colors);r=!0;break;case c.COMMAND_INSERTIMAGE:k=M(b);break;case c.COMMAND_CREATELINK:k=
N(b);break;default:return null}if(r)k.on("click","li",function(){var k=a(this).data("param");g(b,k)});u=J.addClass("cazary-active").offset();u.top+=J.outerHeight();k.addClass("cazary-panel").addClass("cazary-panel-"+b).data("id",K).data("command",b).css({left:u.left+"px",top:u.top+"px"}).on("click",function(){return!1}).appendTo(a(G.body)).find(":text:first").trigger("focus");return k}function e(b,c){var d=a("<ul />").addClass("cazary-widget-select");a.each(c,function(){var b=this.toString(),b=a("<li />").attr({unselectable:"on",
title:b}).css({"font-family":b}).data("param",b).text(b);d.append(b)});return a("<div>").append(d)}function O(b){var c=a("<ul />").addClass("cazary-widget-select");a.each(v,function(b,k){k=l(k);var d=a("<li />").attr({unselectable:"on",title:k}).data("param",b),e=a("<font />").attr({size:b}).text(k);c.append(d.append(e))});return a("<div>").append(c)}function P(b,c){var d=a("<div>");a.each(c,function(){var b=a("<ul />").addClass("cazary-widget-select-color");a.each(this,function(){var c=this.toString(),
c=a("<li />").attr({unselectable:"on",title:c}).css({"background-color":c}).data("param",c).text(c);b.append(c)});d.append(b)});return d}function M(b){function c(){var a=d.find(".cazary-widget-insertimage-url"),r=a.val();if(!B(r))return a.trigger("focus"),!1;g(b,r);return!1}var d=a("<div>").append(a("<form />").attr("action","#").append(a("<div />").append(a("<fieldset />").append(a("<legend />").text(l("Input image URL"))).append(a('<input type="text" />').addClass("cazary-widget-insertimage-url").attr({required:"required",
placeholder:l("http://example.com/path/to/image.jpg")}))).append(a('<input type="submit" />').addClass("cazary-widget-submit").val(l("Insert")))).append(a("<fieldset />").addClass("cazary-widget-preview").append(a("<legend />").text(l("Preview"))).append(a("<img />").addClass("cazary-widget-preview-insertimage"))));return d.on("submit","form",c).on("click",".cazary-widget-submit",c).on("keydown paste",".cazary-widget-insertimage-url",function(){var b=a(this);t.setTimeout(function(){var a=b.val(),
c=b.data("url_old");a!==c&&(b.data("url_old",a),c=d.find(".cazary-widget-preview"),B(a)?(c.show(),d.find(".cazary-widget-preview-insertimage").attr("src",a)):c.hide())},10)})}function N(b){function c(){var a=d.find(".cazary-widget-createlink-url"),e=a.val();if(L(e))e="mailto:"+e;else if(!B(e))return a.trigger("focus"),!1;g(b,e);return!1}var d=a("<div>").append(a("<form />").attr("action","#").append(a("<div />").append(a("<fieldset />").append(a("<legend />").text(l("Input link URL or E-mail address"))).append(a('<input type="text" />').addClass("cazary-widget-createlink-url").attr({required:"required",
placeholder:l("http://example.com/, someone@example.com")}))).append(a('<input type="button" />').addClass("cazary-widget-submit").val(l("Insert")))).append(a("<fieldset />").addClass("cazary-widget-preview").append(a("<legend />").text(l("Preview"))).append(a("<iframe />").addClass("cazary-widget-preview-createlink"))));return d.on("submit","form",c).on("click",".cazary-widget-submit",c).on("keydown paste",".cazary-widget-createlink-url",function(){var b=a(this);t.setTimeout(function(){var a=b.val(),
c=b.data("url_old");a!==c&&(b.data("url_old",a),c=d.find(".cazary-widget-preview"),B(a)?(c.show(),d.find(".cazary-widget-preview-createlink").attr("src",a)):c.hide())},10)})}function x(){var a=c.getCurrentStatus(),b;for(b in a){var d=a[b],e=m.find(".cazary-command-"+b);if(b===c.COMMAND_FONTNAME){var f=d;null===f&&(d="",f=e.attr("title"));e.css({"font-family":d}).text(f)}else b===c.COMMAND_FONTSIZE?(f=d,f=null===f?e.attr("title"):l(v[f]),e.text(f)):b===c.COMMAND_FORECOLOR||b===c.COMMAND_BACKCOLOR?
(m.find(".cazary-command-"+b),null===d?m.find(".cazary-command-"+b).css("background-color",""):m.find(".cazary-command-"+b).css("background-color",d)):(d===c.STATUS_ACTIVE?e.addClass("cazary-active"):e.removeClass("cazary-active"),d===c.STATUS_DISABLED?e.addClass("cazary-disabled"):e.removeClass("cazary-disabled"))}}function F(){z.hasClass("cazary-active")?n.trigger("focus"):c.setFocus()}function H(){var b=a(c.contentDocument.body);0===b.text().length?b.addClass("empty"):b.removeClass("empty")}var K=
parseInt(1E4*Math.random()),n=a(this),m=a('<div class="cazary"><iframe class="cazary-edit" src="javascript:" style="display:none;"></iframe></div>').css({width:n.width()});m.prepend(p(b.commands));var D=m.find(".cazary-edit").css({height:n.height()}),z=m.find("ul.cazary-commands-list li.cazary-command-source"),I=m.find("ul.cazary-commands-list li:not(.cazary-command-source)");n.hide().before(m).insertAfter(D).addClass("cazary-source");var A=b.style,y=n.attr("placeholder");y!==f&&(y=y.replace("'",
"\\'"),A+="body.empty:before{position:fixed;color:#888;content:'"+y+"';}");var c=new Q(D.get(0),n.val(),A),A=[c.COMMAND_BOLD,c.COMMAND_ITALIC,c.COMMAND_UNDERLINE,c.COMMAND_STRIKETHROUGH,c.COMMAND_REMOVEFORMAT,c.COMMAND_SUPERSCRIPT,c.COMMAND_SUBSCRIPT,c.COMMAND_JUSTIFYLEFT,c.COMMAND_JUSTIFYCENTER,c.COMMAND_JUSTIFYRIGHT,c.COMMAND_JUSTIFYFULL,c.COMMAND_INDENT,c.COMMAND_OUTDENT,c.COMMAND_ORDEREDLIST,c.COMMAND_UNORDEREDLIST,c.COMMAND_INSERTHORIZONTALRULE,c.COMMAND_UNLINK,c.COMMAND_UNDO,c.COMMAND_REDO],
y=[c.COMMAND_FONTNAME,c.COMMAND_FONTSIZE,c.COMMAND_FORECOLOR,c.COMMAND_BACKCOLOR,c.COMMAND_INSERTIMAGE,c.COMMAND_CREATELINK];"html"==b.mode?w():h();a(c.contentDocument).on("select",function(){x()}).on("mouseup",function(){d();x()}).on("keydown",function(a){27===a.keyCode&&d()}).on("keyup paste",function(){t.setTimeout(function(){x();H()},10)});a(c.contentWindow).on("focus",function(){d();x()}).on("blur",function(){n.val(c.value())});m.on("click","ul.cazary-commands-list li",function(b){a(this).hasClass("cazary-disabled")&&
(b.stopImmediatePropagation(),F())});z.on("click",function(){z.hasClass("cazary-active")?h():w();F()});a.each(A,function(){var a=this.toLowerCase();m.on("click",".cazary-command-"+a,function(){g(a)})});a.each(y,function(){var c=this.toLowerCase();m.on("click",".cazary-command-"+c,function(){var d=a(this);C(c,b,d);return!1})})})}}(p)})});
